{
  "info": {
    "name": "Work Management API - Complete Tests",
    "description": "Complete API testing collection for Work Management application",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "BASE_URL",
      "value": "https://work-management-chi.vercel.app",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "1. Authentication",
      "item": [
        {
          "name": "1.1 Register User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201\", function() {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test(\"User created successfully\", function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id');",
                  "    pm.expect(jsonData.status).to.eql('unverified');",
                  "    pm.environment.set(\"USER_ID\", jsonData.id);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{BASE_URL}}/users",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{USER_EMAIL}}\",\n  \"username\": \"{{USER_USERNAME}}\",\n  \"password\": \"{{USER_PASSWORD}}\",\n  \"fullName\": \"Test User\"\n}"
            }
          }
        },
        {
          "name": "1.2 Resend Verification Email",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Token received\", function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('token');",
                  "    pm.environment.set(\"VERIFICATION_TOKEN\", jsonData.token);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{BASE_URL}}/auth/resend-verification",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{USER_EMAIL}}\"\n}"
            }
          }
        },
        {
          "name": "1.3 Verify Email",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Email verified\", function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.user.status).to.eql('active');",
                  "    pm.expect(jsonData.user.emailVerifiedAt).to.not.be.null;",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{BASE_URL}}/auth/verify-email",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"token\": \"{{VERIFICATION_TOKEN}}\"\n}"
            }
          }
        },
        {
          "name": "1.4 Login with Email",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Login successful\", function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('thành công');",
                  "    pm.expect(jsonData.user.lastLoginAt).to.not.be.null;",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{BASE_URL}}/users/login",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"emailOrUsername\": \"{{USER_EMAIL}}\",\n  \"password\": \"{{USER_PASSWORD}}\"\n}"
            }
          }
        },
        {
          "name": "1.5 Login with Username",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{BASE_URL}}/users/login",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"emailOrUsername\": \"{{USER_USERNAME}}\",\n  \"password\": \"{{USER_PASSWORD}}\"\n}"
            }
          }
        },
        {
          "name": "1.6 Login Wrong Password (Error)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 401\", function() {",
                  "    pm.response.to.have.status(401);",
                  "});",
                  "",
                  "pm.test(\"Error message correct\", function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('không đúng');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{BASE_URL}}/users/login",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"emailOrUsername\": \"{{USER_EMAIL}}\",\n  \"password\": \"wrongpassword123\"\n}"
            }
          }
        }
      ]
    },
    {
      "name": "2. Magic Link Login",
      "item": [
        {
          "name": "2.1 Request Magic Link",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Token received\", function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.environment.set(\"MAGIC_LINK_TOKEN\", jsonData.token);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{BASE_URL}}/auth/magic-link/request",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{USER_EMAIL}}\"\n}"
            }
          }
        },
        {
          "name": "2.2 Verify Magic Link",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Login successful\", function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('thành công');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{BASE_URL}}/auth/magic-link/verify",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"token\": \"{{MAGIC_LINK_TOKEN}}\"\n}"
            }
          }
        }
      ]
    },
    {
      "name": "3. OTP Login",
      "item": [
        {
          "name": "3.1 Request OTP",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"OTP received\", function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.environment.set(\"OTP\", jsonData.otp);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{BASE_URL}}/auth/otp/request",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{USER_EMAIL}}\"\n}"
            }
          }
        },
        {
          "name": "3.2 Verify OTP",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Login successful\", function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('thành công');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{BASE_URL}}/auth/otp/verify",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{USER_EMAIL}}\",\n  \"otp\": \"{{OTP}}\"\n}"
            }
          }
        }
      ]
    },
    {
      "name": "4. Password Reset",
      "item": [
        {
          "name": "4.1 Forgot Password",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Reset token received\", function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.environment.set(\"RESET_TOKEN\", jsonData.token);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{BASE_URL}}/auth/forgot-password",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{USER_EMAIL}}\"\n}"
            }
          }
        },
        {
          "name": "4.2 Reset Password",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Password reset successful\", function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('thành công');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{BASE_URL}}/auth/reset-password",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"token\": \"{{RESET_TOKEN}}\",\n  \"newPassword\": \"newpassword123\"\n}"
            }
          }
        }
      ]
    },
    {
      "name": "5. Notifications",
      "item": [
        {
          "name": "5.1 Create Notification",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201\", function() {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test(\"Notification created\", function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id');",
                  "    pm.expect(jsonData.isRead).to.eql(false);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{BASE_URL}}/notifications",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": 1,\n  \"projectId\": 1,\n  \"type\": \"project_created\",\n  \"title\": \"Test Notification\",\n  \"message\": \"This is a test notification from Postman\"\n}"
            }
          }
        },
        {
          "name": "5.2 Get All Notifications",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Returns array\", function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": "{{BASE_URL}}/notifications/user/1"
          }
        },
        {
          "name": "5.3 Get Unread Notifications",
          "request": {
            "method": "GET",
            "header": [],
            "url": "{{BASE_URL}}/notifications/user/1/unread"
          }
        },
        {
          "name": "5.4 Get Unread Count",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Count is number\", function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.count).to.be.a('number');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": "{{BASE_URL}}/notifications/user/1/count"
          }
        },
        {
          "name": "5.5 Get Single Notification",
          "request": {
            "method": "GET",
            "header": [],
            "url": "{{BASE_URL}}/notifications/1"
          }
        },
        {
          "name": "5.6 Mark as Read",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Marked as read\", function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.isRead).to.eql(true);",
                  "    pm.expect(jsonData.readAt).to.not.be.null;",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [],
            "url": "{{BASE_URL}}/notifications/1/read"
          }
        },
        {
          "name": "5.7 Mark All as Read",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Returns count\", function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('count');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [],
            "url": "{{BASE_URL}}/notifications/user/1/read-all"
          }
        },
        {
          "name": "5.8 Delete Notification",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 204\", function() {",
                  "    pm.response.to.have.status(204);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": "{{BASE_URL}}/notifications/1"
          }
        },
        {
          "name": "5.9 Delete All Notifications",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": "{{BASE_URL}}/notifications/user/1/all"
          }
        }
      ]
    },
    {
      "name": "6. Users Management",
      "item": [
        {
          "name": "6.1 Get All Users",
          "request": {
            "method": "GET",
            "header": [],
            "url": "{{BASE_URL}}/users"
          }
        },
        {
          "name": "6.2 Get User by ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": "{{BASE_URL}}/users/1"
          }
        },
        {
          "name": "6.3 Change Password",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": "{{BASE_URL}}/users/1/change-password",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"oldPassword\": \"{{USER_PASSWORD}}\",\n  \"newPassword\": \"newpassword456\"\n}"
            }
          }
        }
      ]
    }
  ]
}
